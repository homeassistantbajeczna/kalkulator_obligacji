<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator Obligacji Skarbu Państwa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Dodajemy font DejaVu Sans z CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@canvas-fonts/dejavu-sans@1.0.0/dejavu-sans.min.js"></script>
</head>
<body>
    <div class="logo-container">
        <a href="https://finance-brothers.pl">
            <img src="cropped-logo-FB-1.png" alt="Twoje Logo" class="logo d-block mx-auto">
        </a>
    </div>
    <div class="container">
        <div class="form-section" id="formSection">
            <div class="header-row">
                <h4>Kalkulator Obligacji Skarbu Państwa</h4>
                <label class="checkbox-label header-checkbox">
                    <input type="checkbox" id="ikeIkzeBtn">
                    <span class="checkbox-custom"></span>
                    Inwestycje w IKE lub IKZE
                </label>
            </div>
            <div class="form-container">
                <div class="form-wrapper">
                    <form id="obligacjeForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="kwota" class="form-label">Kwota inwestycji</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="kwota" min="100" max="5000000" step="100" value="10000">
                                    <span class="input-group-text">zł</span>
                                </div>
                                <input type="range" class="form-range" id="kwotaRange" min="100" max="5000000" step="100" value="10000">
                                <div class="sub-info" id="iloscObligacji">Ilość obligacji: 100</div>
                            </div>
                            <div class="form-group">
                                <label for="typObligacji" class="form-label">Typ obligacji*</label>
                                <select class="form-control" id="typObligacji">
                                    <option value="OTS" selected>3-miesięczne (OTS)</option>
                                    <option value="ROR">12-miesięczne (ROR)</option>
                                    <option value="DOR">24-miesięczne (DOR)</option>
                                    <option value="TOS">3-letnie (TOS)</option>
                                    <option value="COI">4-letnie (COI)</option>
                                    <option value="EDO">10-letnie (EDO)</option>
                                    <option value="ROS">6-letnie (ROS)</option>
                                    <option value="ROD">12-letnie (ROD)</option>
                                </select>
                                <div class="sub-info"></div>
                            </div>
                            <div class="form-group" id="dynamicRateGroup" style="display: none;">
                                <label for="dynamicRate" class="form-label" id="dynamicRateLabel">Stopa Ref. NBP</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="dynamicRate" min="0" max="50" step="0.05" value="4.90">
                                    <span class="input-group-text">%</span>
                                </div>
                                <input type="range" class="form-range" id="dynamicRateRange" min="0" max="50" step="0.05" value="4.90">
                                <div class="sub-info"></div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="okres" class="form-label">Okres inwestycji</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="okres" min="3" max="144" step="1" value="3" readonly>
                                    <span class="input-group-text">mc-y</span>
                                </div>
                                <div class="sub-info" id="lata"></div>
                            </div>
                            <div class="form-group">
                                <label for="oprocentowanie" class="form-label">Oprocentowanie</label>
                                <div class="input-group">
                                    <input type="number" class="form-control" id="oprocentowanie" min="0.1" max="25" step="0.1" value="3" readonly>
                                    <span class="input-group-text">%</span>
                                </div>
                                <div class="sub-info" id="oprocentowanieInfo"></div>
                            </div>
                        </div>
                        <div class="variable-rate-container">
                            <div class="checkbox-row" id="variableCheckboxRow">
                                <label class="checkbox-label" id="inflacjaZmiennaLabel" style="display: none;">
                                    <input type="checkbox" id="inflacjaZmiennaBtn">
                                    <span class="checkbox-custom"></span>
                                    Inflacja zmienna
                                </label>
                                <label class="checkbox-label" id="stopaZmiennaLabel" style="display: none;">
                                    <input type="checkbox" id="stopaZmiennaBtn">
                                    <span class="checkbox-custom"></span>
                                    Zmienna Stopa Ref. NBP
                                </label>
                            </div>
                            <div class="variable-inputs" id="variableInputs" style="display: none;">
                                <div class="variable-inputs-wrapper" id="variableInputsWrapper"></div>
                                <button type="button" class="btn btn-secondary btn-sm" id="addVariableBtn" style="display: none;">Dodaj kolejne</button>
                            </div>
                        </div>
                        <div class="form-row">
                            <button type="button" class="btn btn-primary" id="obliczBtn" style="margin: 25px auto 0;">Oblicz</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="opis-container">
                <div class="obligacje-opis" id="obligacjeOpis"></div>
            </div>
            <div class="data-container">
                <div class="data-info"><strong>Dane z dnia:</strong> <span class="data-date"><strong>01.03.2025r.</strong></span></div>
            </div>
        </div>
        <div class="result-section" id="resultSection">
            <div class="result-header">
                <h4 id="resultHeader">Podsumowanie wyników</h4>
                <button id="generatePdfBtn" class="btn btn-primary btn-sm">Generuj PDF</button>
            </div>
            <button class="btn btn-secondary mb-3" onclick="showForm()">Powrót do edycji</button>
            <div class="result-container">
                <div class="result-wrapper">
                    <div class="chart-container">
                        <div class="chart">
                            <canvas id="obligacjeChart"></canvas>
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item" data-index="0">
                                <div class="color-box" style="background-color: #28a745;" data-tooltip="">
                                    <span class="value" id="valueKapital">-</span>
                                </div>
                                <span class="legend-text" id="legendKapital">Kapitał</span>
                            </div>
                            <div class="legend-item" data-index="1">
                                <div class="color-box" style="background-color: #007bff;" data-tooltip="">
                                    <span class="value" id="valueOdsetki">-</span>
                                </div>
                                <span class="legend-text" id="legendOdsetki">Odsetki</span>
                            </div>
                            <div class="legend-item" data-index="2">
                                <div class="color-box" style="background-color: #dc3545;" data-tooltip="">
                                    <span class="value" id="valuePodatek">-</span>
                                </div>
                                <span class="legend-text" id="legendPodatek">Podatek</span>
                            </div>
                        </div>
                    </div>
                    <div class="summary-footer">
                        <span class="highlight yellow" data-hover="3 miesięcy">Okres inwestycji: <span id="okresInwestycji">-</span> mc-y</span>
                        <span class="highlight green" data-hover="">Zysk netto: <span id="zyskNetto">-</span> zł</span>
                    </div>
                    <div class="obligacje-opis" id="obligacjeOpisPodsumowanie"></div>
                </div>
            </div>
            <div class="harmonogram-container">
                <div class="result-wrapper">
                    <div class="harmonogram">
                        <h5 class="btn-toggle" onclick="toggleHarmonogram('harmonogramContent')">Harmonogram odsetek ▼</h5>
                        <div id="harmonogramContent">
                            <table class="table table-striped">
                                <thead id="harmonogramNaglowek">
                                    <tr>
                                        <th id="pierwszaKolumnaNaglowek">Rok</th>
                                        <th>Wartość inwestycji</th>
                                        <th>Oproc.</th>
                                        <th>Odsetki</th>
                                        <th>Suma odsetek</th>
                                        <th>Podatek</th>
                                        <th id="zyskKolumnaNaglowek">Zysk netto</th>
                                        <th>Opłata za wykup</th>
                                        <th id="kolumnaStopaInflacja">Inflacja</th>
                                        <th>Suma netto</th>
                                    </tr>
                                </thead>
                                <tbody id="harmonogramTabela"></tbody>
                            </table>
                            <div class="harmonogram-opis" id="harmonogramOpis"></div>
                        </div>
                    </div>
                    <div class="chart-container-line">
                        <div class="chart-line">
                            <canvas id="obligacjeChartLine"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<style>
body {
    background-color: #f5f6f5;
    font-family: 'Montserrat', sans-serif;
    padding: 10px;
}
.logo-container {
    background-color: #e9ecef;
    padding: 15px;
    text-align: center;
    margin-bottom: 20px;
}
.logo {
    max-width: 200px;
    margin-bottom: 0;
    cursor: pointer;
}
.container {
    max-width: 1200px;
    margin: 30px auto 0;
    background: #FFFFFF;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
}
.header-row {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 15px;
    position: relative;
}
.header-row h4 {
    font-size: 1.2em;
    color: #333333;
    font-weight: 700;
    margin: 0;
}
.checkbox-label {
    display: flex;
    align-items: center;
    font-size: 0.8em;
    color: #333333;
    cursor: pointer;
}
.checkbox-label input {
    display: none;
}
.checkbox-custom {
    width: 16px;
    height: 16px;
    border: 2px solid #C2B280;
    background-color: #fff;
    margin-right: 5px;
    display: inline-block;
    position: relative;
}
.checkbox-label input:checked + .checkbox-custom {
    background-color: #C2B280;
}
.checkbox-label input:checked + .checkbox-custom::after {
    content: '✔';
    color: #000;
    font-size: 12px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}
.checkbox-label.header-checkbox {
    position: absolute;
    top: 0;
    right: 10px;
}
.form-section {
    padding: 10px;
    position: relative;
}
.form-row {
    display: flex;
    justify-content: center;
    margin-bottom: 10px;
    gap: 10px;
    align-items: flex-start;
}
.form-group {
    flex: 1;
    min-width: 0;
    max-width: 150px;
}
.form-label {
    font-size: 0.7em;
    text-transform: uppercase;
    margin-bottom: 2px;
    color: #333333;
}
.form-control, .form-select, .form-range {
    height: 22px;
    font-size: 0.7em;
    padding: 2px;
    text-align: center;
}
.form-select {
    max-width: 100px;
    appearance: none;
    background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAQ0lEQVR42mNgwAfKy8Q/Y//+Ii//3jVAYQzsIFyQ0dOaWq992zxcnN5+9NmyZACV40DmGhPZtzwUAxhUaoLntdha0DqQbtz4E9DzN6XgI0P2VYFlQrUwoQDIgbChLE/0awXiwV5rhugPX6A8BSsYFDqU+rEFdkGZA7+G9HMqaAU6l+0w+NdJD7ADhzhR/4KDZnWOw0QKrVqYc1G+1Dczfx8DR0uv+QJqDRvQxdizFAQAwsy39EZhAAAwAAJ4+Q1XFlAAAAABJRU5ErkJggg==') no-repeat right 5px center;
}
.form-range {
    margin-top: 2px;
    height: 8px;
    background: #d3d3d3;
    border-radius: 5px;
}
.form-range::-webkit-slider-thumb {
    background: #C2B280;
    border: none;
    border-radius: 50%;
    width: 12px;
    height: 12px;
    cursor: pointer;
    -webkit-appearance: none;
}
.form-range::-moz-range-thumb {
    background: #C2B280;
    border: none;
    border-radius: 50%;
    width: 12px;
    height: 12px;
    cursor: pointer;
}
.input-group-text {
    font-size: 0.7em;
    padding: 2px 5px;
}
.sub-info {
    font-size: 0.4em;
    color: #333333;
    margin-top: 2px;
    text-align: left;
}
.opis-container {
    margin-top: 20px;
    text-align: center;
    margin-bottom: 10px;
}
.obligacje-opis, .harmonogram-opis {
    font-size: 0.6em;
    color: #333333;
    text-align: center;
    max-width: 400px;
    margin: 10px auto 0;
    line-height: 1.4;
}
.data-container {
    text-align: right;
    margin-top: 5px;
}
.data-info {
    font-size: 0.8em;
    color: #C2B280;
}
.data-date {
    font-size: 0.8em;
}
.result-section {
    display: none;
    padding: 10px;
    max-width: 1200px;
    margin: 0 auto;
    background: #FFFFFF;
}
.result-header {
    text-align: center;
    margin-bottom: 20px;
    position: relative;
}
.result-header h4 {
    font-size: 1.2em;
    color: #333333;
    font-weight: 700;
    display: inline-block;
}
.chart-container {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-bottom: 20px;
    position: relative;
    overflow: visible;
}
.chart {
    flex: 0 0 auto;
    width: 120px;
    height: 120px;
    position: relative;
    z-index: 25;
}
.chart-legend {
    flex: 0 0 auto;
    max-width: 200px;
    margin: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
}
.chart-legend .legend-item {
    display: flex;
    align-items: center;
    margin-bottom: 6px;
    font-size: 0.7em;
    color: #333333;
    cursor: pointer;
    transition: transform 0.3s ease;
    padding-left: 8px;
}
.chart-legend .color-box {
    width: 90px;
    height: 18px;
    border-radius: 5px;
    text-align: center;
    font-weight: 500;
    line-height: 18px;
    font-size: 0.8em;
    white-space: nowrap;
    overflow: hidden;
    position: relative;
    color: #fff;
    margin-right: 6px;
}
.chart-legend .color-box .value {
    display: block;
}
.chart-legend .color-box:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    color: #fff;
    font-size: 0.8em;
    line-height: 18px;
    text-align: center;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 30;
}
.chart-legend .color-box:hover .value {
    display: none;
}
.chart-legend .legend-text {
    opacity: 1;
    transition: opacity 0.3s ease;
    font-size: 0.7em;
}
.summary-footer {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 10px;
}
.summary-footer .highlight {
    font-size: 0.8em;
    padding: 4px 6px;
    border-radius: 5px;
    position: relative;
    cursor: pointer;
}
.highlight.yellow {
    background-color: #17a2b8;
    color: #ffffff;
}
.highlight.yellow:hover {
    color: transparent;
}
.highlight.yellow:hover::after {
    content: attr(data-hover);
    font-weight: bold;
    font-size: 1.1em;
    color: #ffffff;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
}
.highlight.green {
    background-color: #28a745;
    color: #ffffff;
}
.highlight.green:hover {
    color: transparent;
}
.highlight.green:hover::after {
    content: attr(data-hover);
    font-weight: bold;
    font-size: 1.1em;
    color: #ffffff;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
}
.harmonogram {
    margin-top: 20px;
    font-size: 0.8em;
    background-color: #f9f9f9;
    border-radius: 10px;
    padding: 10px;
}
.harmonogram table {
    margin: 0 auto;
    width: auto;
    max-width: 1000px;
    display: table;
    border-collapse: separate;
    border-spacing: 0;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    background: #f9f9f9;
}
.harmonogram th {
    background: linear-gradient(90deg, #C2B280, #b0a070);
    color: #000000;
    padding: 12px;
    text-align: center;
    vertical-align: middle;
    font-weight: 500;
    border-bottom: 2px solid #ddd;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.harmonogram td {
    padding: 10px;
    text-align: center;
    font-weight: 400;
    border-bottom: 1px solid #eee;
    background-color: #f9f9f9;
    color: #000000;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.btn-toggle {
    cursor: pointer;
    font-size: 0.8em;
    color: #007bff;
    text-decoration: underline;
    margin-bottom: 10px;
}
.btn-primary, .btn-secondary {
    background: linear-gradient(135deg, #C2B280, #b0a070);
    border: none;
    color: #000000;
    font-size: 0.9em;
    padding: 8px 20px;
    width: auto;
    margin: 25px auto 0;
    display: block;
    border-radius: 25px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s ease, box-shadow 0.3s ease;
}
.btn-primary:hover, .btn-secondary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    background: linear-gradient(135deg, #b0a070, #C2B280);
    color: #000000;
}
.btn-sm {
    font-size: 0.7em;
    padding: 3px 10px;
}
#generatePdfBtn {
    position: absolute;
    top: 0;
    right: 10px;
}
#harmonogramContent {
    display: block;
}
.form-container {
    display: flex;
    gap: 20px;
    justify-content: center;
    position: relative;
}
.form-wrapper {
    flex: 1;
    max-width: 400px;
}
.result-container {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
    position: relative;
}
.harmonogram-container {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 20px;
    position: relative;
    background-color: #f9f9f9;
    border-radius: 10px;
    padding: 10px;
}
.result-wrapper {
    flex: 1;
    max-width: 1000px;
}
.result-wrapper h5 {
    font-size: 1em;
    text-align: center;
    margin-bottom: 10px;
    color: #333333;
}
.chart-container-line {
    margin-top: 20px;
    width: 100%;
    height: 400px;
}
.chart-line {
    width: 100%;
    height: 100%;
}
.variable-rate-container {
    margin-top: 15px;
    text-align: center;
}
.checkbox-row {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 10px;
}
.variable-inputs {
    margin-top: 10px;
}
.variable-input-group {
    display: flex;
    flex-direction: column;
    margin-bottom: 10px;
    align-items: center;
}
.fields-wrapper {
    display: flex;
    justify-content: center;
    gap: 10px;
}
.variable-input-group .form-group {
    max-width: 120px;
}
.remove-btn-wrapper {
    display: flex;
    justify-content: center;
    margin-top: 5px;
}
.variable-input-group .form-label {
    text-align: left !important;
    width: 100%;
    padding-left: 0;
}
.variable-input-group .input-group {
    justify-content: center;
}
.variable-input-group .btn-danger {
    font-size: 0.7em;
    padding: 2px 8px;
    height: 22px;
    line-height: 18px;
    background: #dc3545;
    border: none;
    border-radius: 5px;
    color: #fff;
}
.variable-input-group .btn-danger:hover {
    background: #c82333;
}
#addVariableBtn {
    background: linear-gradient(135deg, #C2B280, #b0a070);
    color: #000;
    font-size: 0.7em;
    padding: 3px 10px;
    border-radius: 15px;
    margin: 0 auto;
    display: block;
}
#addVariableBtn:hover {
    background: linear-gradient(135deg, #b0a070, #C2B280);
}
</style>
</html>
<script>
        let kapital = kwota;
        let sumaOdsetek = 0;
        let sumaPodatku = 0;
        let sumaOplat = 0;
        harmonogramData = [];

        const changes = inflacjaZmienna ? variableInflacjaChanges : (stopaZmienna ? variableStopaChanges : []);
        changes.sort((a, b) => a.cykl - b.cykl);

        for (let i = 1; i <= miesiace; i++) {
            let oprocentowanie;
            let stopaInflacja;

            if (config.zmienne) {
                if (isInflacja) {
                    const rok = Math.ceil(i / 12);
                    const change = changes.find(c => c.cykl === rok);
                    stopaInflacja = change ? change.wartosc / 100 : inflacja;
                    oprocentowanie = (rok === 1 ? config.oprocentowanie / 100 : stopaInflacja + (config.marza / 100));
                } else {
                    const change = changes.find(c => c.cykl === i);
                    stopaInflacja = change ? change.wartosc / 100 : stopaRel;
                    oprocentowanie = (i === 1 ? config.oprocentowanie / 100 : stopaInflacja + (config.marza / 100));
                }
            } else {
                oprocentowanie = config.oprocentowanie / 100;
                stopaInflacja = 0;
            }

            let odsetki;
            if (["ROR", "DOR"].includes(typ)) {
                odsetki = kapital * (oprocentowanie / 12);
            } else if (["COI"].includes(typ)) {
                odsetki = i % 12 === 0 ? kapital * oprocentowanie : 0;
            } else {
                odsetki = config.kapitalizacja && i % 12 !== 0 ? 0 : kapital * (oprocentowanie / (config.kapitalizacja ? 1 : 12));
            }

            const podatek = odsetki * podatekBelki;
            const zyskNetto = odsetki - podatek;
            sumaOdsetek += odsetki;
            sumaPodatku += podatek;

            if (config.kapitalizacja && odsetki > 0) {
                kapital += odsetki - podatek;
            }

            const oplataWykup = i === miesiace ? Math.min(kwota * config.oplataWykup, sumaOdsetek - sumaPodatku) : 0;
            sumaOplat += oplataWykup;

            harmonogramData.push({
                okres: ["ROR", "DOR"].includes(typ) ? i : Math.ceil(i / 12),
                kapital: kapital,
                oprocentowanie: (oprocentowanie * 100).toFixed(2),
                odsetki: odsetki,
                sumaOdsetek: sumaOdsetek,
                podatek: podatek,
                zyskNetto: zyskNetto,
                oplataWykup: oplataWykup,
                stopaInflacja: (stopaInflacja * 100).toFixed(2),
                sumaNetto: kapital + sumaOdsetek - sumaPodatku - sumaOplat
            });
        }

        const zyskNetto = sumaOdsetek - sumaPodatku - sumaOplat;

        document.getElementById("formSection").style.display = "none";
        document.getElementById("resultSection").style.display = "block";

        document.getElementById("resultHeader").textContent = `Podsumowanie wyników dla obligacji ${nazwyObligacji[typ]}`;
        document.getElementById("valueKapital").textContent = kwota.toFixed(2) + " zł";
        document.getElementById("valueOdsetki").textContent = sumaOdsetek.toFixed(2) + " zł";
        document.getElementById("valuePodatek").textContent = sumaPodatku.toFixed(2) + " zł";
        document.getElementById("okresInwestycji").textContent = miesiace;
        document.getElementById("zyskNetto").textContent = zyskNetto.toFixed(2);

        const harmonogramTabela = document.getElementById("harmonogramTabela");
        harmonogramTabela.innerHTML = "";
        const pierwszaKolumnaNaglowek = document.getElementById("pierwszaKolumnaNaglowek");
        pierwszaKolumnaNaglowek.textContent = ["ROR", "DOR"].includes(typ) ? "Miesiąc" : "Rok";
        const kolumnaStopaInflacja = document.getElementById("kolumnaStopaInflacja");
        kolumnaStopaInflacja.textContent = isInflacja ? "Inflacja" : "Stopa NBP";
        kolumnaStopaInflacja.style.display = config.zmienne ? "table-cell" : "none";
        const zyskKolumnaNaglowek = document.getElementById("zyskKolumnaNaglowek");
        zyskKolumnaNaglowek.textContent = isIkeIkzeMode ? "Zysk" : "Zysk netto";

        harmonogramData.forEach((row, index) => {
            if (["ROR", "DOR"].includes(typ) || index % 12 === 0) {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${row.okres}</td>
                    <td>${row.kapital.toFixed(2)} zł</td>
                    <td>${row.oprocentowanie}%</td>
                    <td>${row.odsetki.toFixed(2)} zł</td>
                    <td>${row.sumaOdsetek.toFixed(2)} zł</td>
                    <td>${row.podatek.toFixed(2)} zł</td>
                    <td>${row.zyskNetto.toFixed(2)} zł</td>
                    <td>${row.oplataWykup.toFixed(2)} zł</td>
                    <td style="display: ${config.zmienne ? 'table-cell' : 'none'}">${row.stopaInflacja}%</td>
                    <td>${row.sumaNetto.toFixed(2)} zł</td>
                `;
                harmonogramTabela.appendChild(tr);
            }
        });

        const harmonogramOpis = document.getElementById("harmonogramOpis");
        harmonogramOpis.innerHTML = `Harmonogram odsetek dla obligacji ${nazwyObligacji[typ]}. Suma odsetek: ${sumaOdsetek.toFixed(2)} zł, podatek: ${sumaPodatku.toFixed(2)} zł, opłaty za wykup: ${sumaOplat.toFixed(2)} zł, zysk netto: ${zyskNetto.toFixed(2)} zł.`;

        if (chart) chart.destroy();
        chart = new Chart(document.getElementById("obligacjeChart"), {
            type: "doughnut",
            data: {
                labels: ["Kapitał", "Odsetki", "Podatek"],
                datasets: [{
                    data: [kwota, sumaOdsetek, sumaPodatku],
                    backgroundColor: ["#28a745", "#007bff", "#dc3545"],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || "";
                                const value = context.raw || 0;
                                return `${label}: ${value.toFixed(2)} zł`;
                            }
                        }
                    }
                }
            }
        });

        if (chartLine) chartLine.destroy();
        chartLine = new Chart(document.getElementById("obligacjeChartLine"), {
            type: "line",
            data: {
                labels: harmonogramData.map(row => ["ROR", "DOR"].includes(typ) ? `M${row.okres}` : `R${row.okres}`),
                datasets: [
                    {
                        label: "Kapitał",
                        data: harmonogramData.map(row => row.kapital),
                        borderColor: "#28a745",
                        fill: false
                    },
                    {
                        label: "Suma odsetek",
                        data: harmonogramData.map(row => row.sumaOdsetek),
                        borderColor: "#007bff",
                        fill: false
                    },
                    {
                        label: "Suma netto",
                        data: harmonogramData.map(row => row.sumaNetto),
                        borderColor: "#ff851b",
                        fill: false
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: { title: { display: true, text: ["ROR", "DOR"].includes(typ) ? "Miesiąc" : "Rok" } },
                    y: { title: { display: true, text: "Wartość (zł)" } }
                }
            }
        });

        document.getElementById("generatePdfBtn").onclick = () => generatePDF(kwota, typ, miesiace, zyskNetto, sumaOdsetek, sumaPodatku, sumaOplat);
    }

    function generatePDF(kwota, typ, miesiace, zyskNetto, sumaOdsetek, sumaPodatku, sumaOplat) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        // Dodajemy font DejaVu Sans
        doc.addFont("DejaVuSans", "DejaVuSans", "normal");
        doc.setFont("DejaVuSans");

        doc.setFontSize(16);
        doc.text("Podsumowanie inwestycji w obligacje", 105, 20, { align: "center" });

        doc.setFontSize(12);
        doc.text(`Typ obligacji: ${nazwyObligacji[typ]}`, 20, 40);
        doc.text(`Kwota inwestycji: ${kwota.toFixed(2)} zł`, 20, 50);
        doc.text(`Okres inwestycji: ${miesiace} miesięcy`, 20, 60);
        doc.text(`Suma odsetek: ${sumaOdsetek.toFixed(2)} zł`, 20, 70);
        doc.text(`Podatek: ${sumaPodatku.toFixed(2)} zł`, 20, 80);
        doc.text(`Opłaty za wykup: ${sumaOplat.toFixed(2)} zł`, 20, 90);
        doc.text(`Zysk netto: ${zyskNetto.toFixed(2)} zł`, 20, 100);

        doc.setFontSize(10);
        doc.text("Harmonogram odsetek:", 20, 120);

        const tableData = harmonogramData
            .filter((row, index) => ["ROR", "DOR"].includes(typ) || index % 12 === 0)
            .map(row => [
                row.okres.toString(),
                `${row.kapital.toFixed(2)} zł`,
                `${row.oprocentowanie}%`,
                `${row.odsetki.toFixed(2)} zł`,
                `${row.sumaOdsetek.toFixed(2)} zł`,
                `${row.podatek.toFixed(2)} zł`,
                `${row.zyskNetto.toFixed(2)} zł`,
                `${row.oplataWykup.toFixed(2)} zł`,
                obligacjeConfig[typ].zmienne ? `${row.stopaInflacja}%` : "-",
                `${row.sumaNetto.toFixed(2)} zł`
            ]);

        doc.autoTable({
            startY: 130,
            head: [[
                ["ROR", "DOR"].includes(typ) ? "Miesiąc" : "Rok",
                "Wartość inwestycji",
                "Oproc.",
                "Odsetki",
                "Suma odsetek",
                "Podatek",
                isIkeIkzeMode ? "Zysk" : "Zysk netto",
                "Opłata za wykup",
                obligacjeConfig[typ].zmienne ? (["COI", "EDO", "ROS", "ROD"].includes(typ) ? "Inflacja" : "Stopa NBP") : "-",
                "Suma netto"
            ]],
            body: tableData,
            styles: { font: "DejaVuSans", fontSize: 8 },
            headStyles: { fillColor: [194, 178, 128] },
            columnStyles: {
                8: { cellWidth: obligacjeConfig[typ].zmienne ? "auto" : 0, textColor: obligacjeConfig[typ].zmienne ? "black" : "white" }
            }
        });

        const opis = opisyObligacji[typ].replace(/<strong>/g, "").replace(/<\/strong>/g, "");
        const opisLines = doc.splitTextToSize(opis, 170);
        doc.text(opisLines, 20, doc.lastAutoTable.finalY + 10);

        doc.save(`Podsumowanie_obligacje_${typ}.pdf`);
    }

    document.getElementById("obliczBtn").addEventListener("click", obliczObligacje);
    document.getElementById("inflacjaZmiennaBtn").addEventListener("change", updateVariableInputs);
    document.getElementById("stopaZmiennaBtn").addEventListener("change", updateVariableInputs);
    document.getElementById("addVariableBtn").addEventListener("click", addVariableChange);
</script>
